#!/bin/bash

awk '
{
    # Extract IP (field 1)
    ip = $1
    # Extract HTTP status code - field after the request which is inside quotes.
    # The request field is usually the 6th field onward in logs like:
    # 127.0.0.1 - - [date] "GET /path HTTP/1.1" 200 ...
    # So status code is usually the 9th field.
    status = $9
    count[ip, status]++
}
END {
    for (key in count) {
        split(key, arr, SUBSEP)
        ip = arr[1]
        status = arr[2]
        print count[key], ip, status
    }
}' apache-access.log | sort -nr
